<% content_for :title, @post.title %>

<style shim-shadowdom>    
  core-scroll-header-panel::shadow #headerBg {
    background-image: url('<%= @post.image_url %>');
  }
</style>


  <core-scroll-header-panel condenses noReveal>

    <core-toolbar>
      <paper-icon-button icon="arrow-back" center-justified center id="show_post_back" size="27"></paper-icon-button>
      <div flex></div>
      <% if User.find_by_id(session[:user_id]) != nil %>
        <% if User.find_by_id(session[:user_id]).administrator %>
          <paper-icon-button icon="create" center-justified center size="27" id="show_post_edit"></paper-icon-button>
          <paper-icon-button icon="clear" center-justified center size="27" id="show_post_delete"></paper-icon-button>
          <%= link_to 'Destroy', @post, method: :delete, id: "delete_post_invis", data: { confirm: 'Are you sure?' } %>
        <% end %>
      <% end %>
        <div flex class="bottom" start-justified layout vertical id="the_title" self-end>
          <div class="sub">By <%= @post.author %> | <%= @post.created_at.in_time_zone('Eastern Time (US & Canada)').strftime("%B %e at %l:%M%P") %></div>
          <div class="title" layout vertical flex start-justified><%= @post.title %></div>
        </div>
    </core-toolbar>

    <div id="show_post_cnt" class="content">
      <div class="redactor_textt">
        <% if notice %>
          <paper-toast id="toast1" class="capsule" text="<%= notice %>" style="padding-right: 60px;" duration="10000" opened responsiveWidth="300px" style="color: #eeff41;"></paper-toast>
        <% end %>
        <%= raw @post.content %>
      </div>
    </div>
    
  </core-scroll-header-panel>

    <script>
  
    // custom transformation: scale header's title
    var titleStyle = document.querySelector('#the_title').style;

    addEventListener('core-header-transform', function(e) {
      var d = e.detail;
      var m = d.height - d.condensedHeight;

      var scale = Math.max(0.75, (m - d.y) / (m / 0.25)  + 0.75);
      titleStyle.webkitTransform = titleStyle.transformOrigin = 
          'scale(' + scale + ')';
      var shadow = (1 - d.y/d.height).toFixed(2);
      $('#the_title').css('opacity', shadow);
      var shadowstring = "rgba(0,0,0,"+shadow+") 5px 5px 10px";
      $('.title').css('text-shadow', shadowstring);

    });  


    function deletePost() {
      if(confirm('Are you sure?')) {
        window.open("<%= posts_path %>", "_self");
      }
    }

$('#show_post_edit').on('click', function() {
  document.location='<%= edit_post_path(@post) %>';
});
$('#show_post_back').on('click', function() {
  document.location='<%= posts_path %>';
});
$('#show_post_delete').on('click', function() {
  $('#delete_post_invis').click();
});
</script>
<script>

  // var image = new Image();
  // image.src = "<%= @post.image_url %>";
  // var colorThief = new ColorThief();
  // var color =colorThief.getColor(image);
  // var red = color[0];
  // var green = color[1];
  // var blue = color[2];
  // var domrgb = "rgb(" +red + "," + green + "," + blue + ")";

  // var css= 'core-scroll-header-panel::shadow #condensedHeaderBg { background-color: '+ domrgb +'; }', head= document.head || document.getElementByTagName('head')[0], style = document.createElement('style');
  // style.type = 'text/css';
  // if (style.styleSheet){
  //   style.styleSheet.cssText = css;
  // } else {
  //   style.appendChild(document.createTextNode(css));
  // }
  // head.appendChild(style);

  // var pal =  colorThief.getPalette(image, 7);
  // // console.log(pal);
  // var sixthpal = pal[5];
  // console.log(sixthpal)
  // var sixthpalcolor = "rgb(" + (255-sixthpal[0]) + ","+(255-sixthpal[1]) +"," +(255-sixthpal[2]) +")";
  // var title = document.getElementById("the_title");
  // title.style.color = sixthpalcolor;

</script>